<!DOCTYPE html>
<html lang="es">
<head>
        <meta charset="utf-8">
        <title>@#$%_ - python</title>
        <link rel="stylesheet" href="http://iferminmontilla.com/theme/css/main.css">
                <link href="http://iferminmontilla.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="@#$%_ Atom Feed" />
                
        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://iferminmontilla.com/">@#$%_ </a></h1>
                <nav><ul>
                                                                                    <li ><a href="http://iferminmontilla.com/category/acerca-de.html">Acerca de...</a></li>
                                    <li ><a href="http://iferminmontilla.com/category/blog.html">Blog</a></li>
                                    <li ><a href="http://iferminmontilla.com/category/cv.html">CV</a></li>
                                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://iferminmontilla.com/clientes-soap-en-python.html">Clientes SOAP en Python</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2013-08-18T08:30:00">
                dom 18 agosto 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://iferminmontilla.com/author/israel-fermin-montilla.html">Israel Fermín Montilla</a>
        </address>
        <p>In <a href="http://iferminmontilla.com/category/blog.html">Blog</a>. </p>
<p>tags: <a href="http://iferminmontilla.com/tag/python.html">python</a><a href="http://iferminmontilla.com/tag/web-services.html">web services</a><a href="http://iferminmontilla.com/tag/soap.html">soap</a></p>
</footer><!-- /.post-info --><p>Como todos saben, y algunos me chalequean por eso, en la
primera mitad de 2013 cambié de trabajo dos veces, estaba
algo aburrido en Metamax y decidí aceptar una oportunidad
en 4geeks, junto con una serie de proyectos para una empresa
en el extranjero que pintaban bastante bien, una vez que terminé
los proyectos de la otra empresa, terminé enamorándome del proyecto
que desarrollaba desde 4geeks y uniéndome al startup a tiempo completo.</p>
<p>La historia en 4geeks es muy graciosa, un tal Saúl Lustgarten
llevaba tiempo escribiendo en todas las listas de correo donde
estoy pidiendo un desarrollador Python, incluso me contactó personalmente
varias veces vía email y a través de <em>LinkedIn</em> para desarrollar su
<em>startup</em>, una central telefónica en la nube llamada <em>RingTu</em>, el tema
era que no me resultaba atractivo, así que en ese momento acepté la oferta
de 4geeks.</p>
<p>El primer día en 4geeks, me informan acerca del proyecto que iba a desarrollar,
&quot;vas a hacer uno de los startups de Wayra, es una central telefónica en la nube&quot;
y yo &quot;¿RingTu?&quot;, &quot;sí ese mismo&quot;, vaya, al parecer hasta se las arregló para que
desde 4geeks desarrollara su startup, jajajajajajaja.</p>
<p>Básicamente lo que debía hacer era unos wrappers para unos servicios web
que ellos consumen, ese era sólo el inicio del proyecto, pensé que sería
divertido, ya había hecho wrappers para otros servicios web, y en Python
es muy fácil hacer clientes para servicios web, sin importar si hablan JSON o
XML o algún protocolo propio, la cosa se puso esotérica cuando vi que todos
los URL de los servicios con los que iba a trabajar terminaban en .wsdl.</p>
<p>¿SOAP?, con el boom de REST ¿quién usa SOAP?, en fin, ¿qué tan difícil puede ser?,
en Java es realmente fácil escribir clientes y servicios web usando SOAP y en
Python no debe ser la excepción, hay librerías para todo, dejé de hacerme
preguntas acerca del sentido de la vida, el universo y todo lo demás y puse manos
a la obra a investigar alguna buena librería que me facilitara el trabajo.</p>
<p>Luego de unos minutos leyendo en <em>StackOverflow</em>, vi que al parecer suds era
la mejor opción, no se veía tan abandonada y, comparada a las demás opciones,
tenía una documentación decente.</p>
<p>Lo primero es, obviamente, instalarla:</p>
<div class="highlight"><pre>pip install suds
</pre></div>
<p>Recuerden que siempre es buena práctica trabajar con virtualenvs y, además, es muy
buena opción el hecho de utilizar virtualenvwrapper para gestionarlos.</p>
<p>Una vez que tenemos suds ya instalado, es sólo cuestión de empezar a utilizarla,
para hacer clientes, que es de lo que hablaré en este post, sólo nos interesa la
clase definida en <em>suds.client.Client</em>.</p>
<p>Si repasamos un poco de teoría acerca de los servicios web sobre el protocolo SOAP,
veremos que se convirtió en la capa subyacente para servicios complejos basados en
WSDL, que es una manera de especificar los objetos y métodos que expone un servicio web
y a los que el cliente puede tener acceso. WSDL es un acrónimo que significa <em>Web Service
Description Language</em>.</p>
<p>Toda la definición de servicios web SOAP se hace en un documento WSDL, que no es mas que un
XML donde se define todo lo que este servicio expone para ser consumido por sus clientes.
De igual manera, el pase de mensajes (soap messages) entre el cliente y el servidor, se hace
en formato XML.</p>
<p>A continuación un ejemplo de documento WSDL:</p>
<div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;description</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/ns/wsdl&quot;</span>
             <span class="na">xmlns:tns=</span><span class="s">&quot;http://www.tmsws.com/wsdl20sample&quot;</span>
             <span class="na">xmlns:whttp=</span><span class="s">&quot;http://schemas.xmlsoap.org/wsdl/http/&quot;</span>
             <span class="na">xmlns:wsoap=</span><span class="s">&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;</span>
             <span class="na">targetNamespace=</span><span class="s">&quot;http://www.tmsws.com/wsdl20sample&quot;</span><span class="nt">&gt;</span>

<span class="c">&lt;!-- Tipos Abstractos --&gt;</span>
   <span class="nt">&lt;types&gt;</span>
      <span class="nt">&lt;xs:schema</span> <span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
                <span class="na">xmlns=</span><span class="s">&quot;http://www.tmsws.com/wsdl20sample&quot;</span>
                <span class="na">targetNamespace=</span><span class="s">&quot;http://www.example.com/wsdl20sample&quot;</span><span class="nt">&gt;</span>

         <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;request&quot;</span><span class="nt">&gt;</span> ... <span class="nt">&lt;/xs:element&gt;</span>
         <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;response&quot;</span><span class="nt">&gt;</span> ... <span class="nt">&lt;/xs:element&gt;</span>
      <span class="nt">&lt;/xs:schema&gt;</span>
   <span class="nt">&lt;/types&gt;</span>

<span class="c">&lt;!-- Interfaces abstractas --&gt;</span>
   <span class="nt">&lt;interface</span> <span class="na">name=</span><span class="s">&quot;Interface1&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fault</span> <span class="na">name=</span><span class="s">&quot;Error1&quot;</span> <span class="na">element=</span><span class="s">&quot;tns:response&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;operation</span> <span class="na">name=</span><span class="s">&quot;Opp1&quot;</span> <span class="na">pattern=</span><span class="s">&quot;http://www.w3.org/ns/wsdl/in-out&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;input</span> <span class="na">messageLabel=</span><span class="s">&quot;In&quot;</span> <span class="na">element=</span><span class="s">&quot;tns:request&quot;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;output</span> <span class="na">messageLabel=</span><span class="s">&quot;Out&quot;</span> <span class="na">element=</span><span class="s">&quot;tns:response&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/operation&gt;</span>
   <span class="nt">&lt;/interface&gt;</span>

<span class="c">&lt;!-- Interface concreta sobre HTTP --&gt;</span>
   <span class="nt">&lt;binding</span> <span class="na">name=</span><span class="s">&quot;HttpBinding&quot;</span> <span class="na">interface=</span><span class="s">&quot;tns:Interface1&quot;</span>
            <span class="na">type=</span><span class="s">&quot;http://www.w3.org/ns/wsdl/http&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;operation</span> <span class="na">ref=</span><span class="s">&quot;tns:Get&quot;</span> <span class="na">whttp:method=</span><span class="s">&quot;GET&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/binding&gt;</span>

<span class="c">&lt;!-- Interface concreta sobre SOAP --&gt;</span>
   <span class="nt">&lt;binding</span> <span class="na">name=</span><span class="s">&quot;SoapBinding&quot;</span> <span class="na">interface=</span><span class="s">&quot;tns:Interface1&quot;</span>
            <span class="na">type=</span><span class="s">&quot;http://www.w3.org/ns/wsdl/soap&quot;</span>
            <span class="na">wsoap:protocol=</span><span class="s">&quot;http://www.w3.org/2003/05/soap/bindings/HTTP/&quot;</span>
            <span class="na">wsoap:mepDefault=</span><span class="s">&quot;http://www.w3.org/2003/05/soap/mep/request-response&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;operation</span> <span class="na">ref=</span><span class="s">&quot;tns:Ge99t&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/binding&gt;</span>


<span class="c">&lt;!-- Endpoints que ofrecen el servicio --&gt;</span>
   <span class="nt">&lt;service</span> <span class="na">name=</span><span class="s">&quot;Service1&quot;</span> <span class="na">interface=</span><span class="s">&quot;tns:Interface1&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;endpoint</span> <span class="na">name=</span><span class="s">&quot;HttpEndpoint&quot;</span>
                <span class="na">binding=</span><span class="s">&quot;tns:HttpBinding&quot;</span>
                <span class="na">address=</span><span class="s">&quot;http://www.example.com/rest/&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;endpoint</span> <span class="na">name=</span><span class="s">&quot;SoapEndpoint&quot;</span>
                <span class="na">binding=</span><span class="s">&quot;tns:SoapBinding&quot;</span>
                <span class="na">address=</span><span class="s">&quot;http://www.example.com/soap/&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/service&gt;</span>
<span class="nt">&lt;/description&gt;</span>
</pre></div>
<p>La sección <em>types</em> describe los tipos de dato a los que da soporte el servicio web
que se está describiendo. Las <em>interfaces</em>, definen un servicio como tal, es decir,
las operaciones que pueden ser realizadas y los mensajes que son soportados para realizar
cada operación. Los <em>bindings</em> especifican la interface y cómo deben ser pasados los mensajes
e incluso el protocolo que debe ser utilizado para el transporte. Finalmente, los <em>endpoints</em>,
definen los puntos de conexión con el servicio web.</p>
<p>Por otra parte, un mensaje SOAP debería verse de la siguiente manera:</p>
<div class="highlight"><pre>POST /InStock HTTP/1.1
Host: www.example.org
Content-Type: application/soap+xml; charset=utf-8
Content-Length: 299
SOAPAction: &quot;http://www.w3.org/2003/05/soap-envelope&quot;

<span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;soap:Envelope</span> <span class="na">xmlns:soap=</span><span class="s">&quot;http://www.w3.org/2003/05/soap-envelope&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;soap:Header&gt;</span>
    <span class="nt">&lt;/soap:Header&gt;</span>
    <span class="nt">&lt;soap:Body&gt;</span>
        <span class="nt">&lt;m:GetStockPrice</span> <span class="na">xmlns:m=</span><span class="s">&quot;http://www.example.org/stock&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;m:StockName&gt;</span>IBM<span class="nt">&lt;/m:StockName&gt;</span>
        <span class="nt">&lt;/m:GetStockPrice&gt;</span>
    <span class="nt">&lt;/soap:Body&gt;</span>
<span class="nt">&lt;/soap:Envelope&gt;</span>
</pre></div>
<p>En un mensaje, el <em>envelope</em> es lo que identifica el XML como un mensaje SOAP,
el <em>header</em> contiene información de encabezado, como por ejemplo, llaves de autenticación
o tokens de acceso. Finalmente, el <em>body</em> o cuerpo del mensaje, es el que contiene
el mensaje como tal que se está enviando, ya sea en solicitud o respuesta del servicio.</p>
<p>En este caso, se está invocando una función remota <em>GetStockPrice</em> definida en un namespace <em>m</em>
del wsdl que describe este servicio. A esta función remota se le está enviando un argumento llamado
<em>StockName</em> y el valor de este argumento es <em>IBM</em>, el servicio debería retornar el precio del producto
cuyo <em>StockName</em> sea <em>IBM</em></p>
<p>Para que pueda darse el intercambio de información entre un cliente y un servidor SOAP, ambos deben tener
conocimiento de lo que está definido en el descriptor del servicio, es decir, ambos deben tener acceso
al WSDL, es por ello que lo usual es que el proveedor del servicio web exponga el documento en un URL accesible.</p>
<p>Para este tutorial, usaremos este servicio web: <a class="reference external" href="http://www.webservicex.com/globalweather.asmx?WSDL">http://www.webservicex.com/globalweather.asmx?WSDL</a>, que es un
servicio web de clima. Acá: <a class="reference external" href="http://www.service-repository.com/operation/operations?id=4">http://www.service-repository.com/operation/operations?id=4</a> podemos observar
las operaciones y sus parámetros en un formato amigable al humano :-).</p>
<p>Lo primero es, en nuestro caso, construir una instancia de suds.client.Client que tenga conocimiento
del WSDL que describe el servicio que vamos a usar:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">suds.client</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;http://www.webservicex.com/globalweather.asmx?WSDL&#39;</span><span class="p">)</span>
</pre></div>
<p>Listo, ya tenemos un cliente SOAP listo para consumir el servicio desde Python.</p>
<p>Lo que nos queda es revisar la documentación del servicio o, si no la hay, el WSDL
para ver cuáles objetos pueden ser pasados como mensajes, construir el request e
invocar el método remoto, para ello nos interesan: Client.factory y Client.service.</p>
<p>Por ejemplo, obtengamos el tiempo para Caracas - Venezuela:</p>
<div class="highlight"><pre><span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;tns:GetWeather&#39;</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">CityName</span> <span class="o">=</span> <span class="s">&#39;Caracas&#39;</span>
<span class="n">request</span><span class="o">.</span><span class="n">CountryName</span> <span class="o">=</span> <span class="s">&#39;Venezuela&#39;</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">GetWeather</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
<p>Listo, así de fácil, explorando la documentación o el WSDL veremos que hay un objeto
llamado <em>GetWeather</em> definido en el namespace <em>tns</em>, este objeto tiene dos campos <em>string</em>:
<em>CityName</em> y <em>CountryName</em>, también, si vemos la definición de la respuesta en el WSDL, podremos
observar que es un texto plano (es decir, viene un objeto primitivo <em>string</em> como SOAPResponse).
Vamos a ver cómo maneja suds ambos casos:</p>
<div class="highlight"><pre><span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="n">instance</span>
<span class="k">print</span> <span class="n">request</span>
<span class="p">(</span><span class="n">GetWeather</span><span class="p">){</span>
   <span class="n">CityName</span> <span class="o">=</span> <span class="s">&quot;Caracas&quot;</span>
   <span class="n">CountryName</span> <span class="o">=</span> <span class="s">&quot;Venezuela&quot;</span>
<span class="p">}</span>
<span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="n">suds</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">Text</span>
<span class="k">print</span> <span class="n">response</span>
<span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-16&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">CurrentWeather</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Location</span><span class="o">&gt;</span><span class="n">Caracas</span> <span class="o">/</span> <span class="n">Maiquetia</span> <span class="n">Aerop</span><span class="o">.</span> <span class="n">Intl</span><span class="o">.</span> <span class="n">Simon</span> <span class="n">Bolivar</span><span class="p">,</span> <span class="n">Venezuela</span> <span class="p">(</span><span class="n">SVMI</span><span class="p">)</span> <span class="mi">10</span><span class="o">-</span><span class="mi">36</span><span class="n">N</span> <span class="mo">066</span><span class="o">-</span><span class="mi">59</span><span class="n">W</span> <span class="mi">48</span><span class="n">M</span><span class="o">&lt;/</span><span class="n">Location</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Time</span><span class="o">&gt;</span><span class="n">Aug</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2013</span> <span class="o">-</span> <span class="mi">09</span><span class="p">:</span><span class="mo">00</span> <span class="n">PM</span> <span class="n">EDT</span> <span class="o">/</span> <span class="mf">2013.08</span><span class="o">.</span><span class="mi">19</span> <span class="mo">0100</span> <span class="n">UTC</span><span class="o">&lt;/</span><span class="n">Time</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Wind</span><span class="o">&gt;</span> <span class="n">Calm</span><span class="p">:</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">Wind</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Visibility</span><span class="o">&gt;</span> <span class="n">greater</span> <span class="n">than</span> <span class="mi">7</span> <span class="n">mile</span><span class="p">(</span><span class="n">s</span><span class="p">):</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">Visibility</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">SkyConditions</span><span class="o">&gt;</span> <span class="n">partly</span> <span class="n">cloudy</span><span class="o">&lt;/</span><span class="n">SkyConditions</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Temperature</span><span class="o">&gt;</span> <span class="mi">82</span> <span class="n">F</span> <span class="p">(</span><span class="mi">28</span> <span class="n">C</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">Temperature</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">DewPoint</span><span class="o">&gt;</span> <span class="mi">80</span> <span class="n">F</span> <span class="p">(</span><span class="mi">27</span> <span class="n">C</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">DewPoint</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">RelativeHumidity</span><span class="o">&gt;</span> <span class="mi">94</span><span class="o">%&lt;/</span><span class="n">RelativeHumidity</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Pressure</span><span class="o">&gt;</span> <span class="mf">29.88</span> <span class="ow">in</span><span class="o">.</span> <span class="n">Hg</span> <span class="p">(</span><span class="mi">1012</span> <span class="n">hPa</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">Pressure</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Status</span><span class="o">&gt;</span><span class="n">Success</span><span class="o">&lt;/</span><span class="n">Status</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">CurrentWeather</span><span class="o">&gt;</span>
</pre></div>
<p>Como veremos, suds nos crea un objeto Python a partir de la definición que obtuvo del
WSDL en el caso del <em>request</em> que se construye a partir de la fábrica del cliente usando
el objeto remoto <em>tns:GetWeather</em> como plantilla.</p>
<p>En el caso del response, que está declarada como string, nos envía un objeto suds.sax.text.Text,
que puede ser tratado como un objeto string o unicode Python normalmente.</p>
<p>Suds, no sólo nos hace más fácil la interacción con servicios SOAP, sino que también nos abstrae
del hecho de que tratamos con objetos remotos, convirtiendo todo a objetos Python por nosotros.</p>
<p>En algunos casos es necesario autenticarse contra un servicio web para poder utilizar sus métodos
remotos, usualmente eso se hace a través de un método público de autenticación que revisa los
permisos y retorna un token de acceso encapsulado en un objeto, este objeto debe colocarse en el
header de los requests que van dirigidos a los métodos privados.</p>
<p>Debido a que no conseguí ningún servicio web que me permitiera hacer un ejemplo de esto, simplemente
haré un ejemplo <em>dummy</em> de cómo sería en código:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">suds.client</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">auth_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s">&#39;http://www.servicio.com/authservice.wsdl&#39;</span><span class="p">)</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">auth_client</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;ns:AuthObjectRequest&#39;</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">login</span> <span class="o">=</span> <span class="s">&#39;MiUsuarioParaElServicio&#39;</span>
<span class="n">request</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s">&#39;MiClaveSuperSegura&#39;</span>

<span class="n">auth_object</span> <span class="o">=</span> <span class="n">auth_client</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">GetAccessToken</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s">&#39;https://www.servicio.com/otras_cosas.wsdl&#39;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">soapheaders</span><span class="o">=</span><span class="n">auth_object</span><span class="p">)</span>
</pre></div>
<p>Algunas veces, basta sólo con un objeto que contenga el usuario y el password para
el servicio (como el request de este ejemplo) en el soapheaders del client y listo.</p>
<p>La única desventaja que vi al trabajar con suds es que no viene con soporte nativo
para attachments, sin embargo, es relativamente fácil añadir esta funcionalidad en
<a class="reference external" href="https://gist.github.com/iferminm/6265400">este gist</a> podemos ver el código para hacerlo.</p>
<p>La manera de utilizarlo es la siguiente:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">suds.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">soap_attachments</span> <span class="kn">import</span> <span class="n">with_soap_attachment</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;http://www.servicio.com/wsdl/servicio.wsdl&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/home/user/music/panama.mp3&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">mime_type</span> <span class="o">=</span> <span class="s">&#39;audio/mpeg&#39;</span>
<span class="n">bin_param</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mime_type</span><span class="p">)</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;ns0:RequestConAttachment&#39;</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">usuario</span> <span class="o">=</span> <span class="s">&#39;iferminm&#39;</span>
<span class="n">request</span><span class="o">.</span><span class="n">nombre_audio</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">with_soap_attachment</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">subir_pista</span><span class="p">,</span> <span class="n">bin_param</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</pre></div>
<p>Básicamente lo que se hace es leer los bytes que conforman el archivo y colocarlos en el
cuerpo del mensaje SOAP (eso hace with_soap_attachment), lo único que hay que saber acá
es que el endpoint (que se ve como parámetro en la llamada a with_soap_attachment) es el
punto de conexión al servicio web especificado en el WSDL.</p>
<p>De esta manera, colocamos un archivo adjunto al mensaje SOAP para que sea subido al servidor
vía SOAP.</p>
<p>Para más información recomiendo revisar la documentación de la librería <a class="reference external" href="https://fedorahosted.org/suds/wiki/Documentation">acá</a>, sin embargo, para
hacer clientes para servicios SOAP básicos, con este tutorial debería ser suficiente.</p>
<p>There are <a href="http://iferminmontilla.com/clientes-soap-en-python.html#disqus_thread">comments</a>.</p>                </article>
                            </aside><!-- /#featured -->
                            <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">
                                                

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="http://iferminmontilla.com/cosas-que-amo-de-python-vi-esta-en-todas-partes.html" rel="bookmark"
                           title="Permalink to Cosas que AMO de Python VI: Está en TODAS partes">Cosas que AMO de Python VI: Está en TODAS partes</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2011-11-30T07:40:00">
                mié 30 noviembre 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://iferminmontilla.com/author/israel-fermin-montilla.html">Israel Fermín Montilla</a>
        </address>
        <p>In <a href="http://iferminmontilla.com/category/blog.html">Blog</a>. </p>
<p>tags: <a href="http://iferminmontilla.com/tag/lenguajes.html">Lenguajes</a><a href="http://iferminmontilla.com/tag/programacion.html">Programación</a><a href="http://iferminmontilla.com/tag/python.html">python</a></p>
</footer><!-- /.post-info -->                <p>Si, resistirse es inútil, donde sea que estés tendrás Python a la mano,
menos en Windows que debes instalarlo, pero lo interesante es que puedes
tenerlo de igual manera.</p>
<p>Escogí el número 6 romano (VI) de manera
intencional para esta entrada ya que, con Python, pasa igual que con el ...</p>
                <a class="readmore" href="http://iferminmontilla.com/cosas-que-amo-de-python-vi-esta-en-todas-partes.html">read more</a>
                <p>There are <a href="http://iferminmontilla.com/cosas-que-amo-de-python-vi-esta-en-todas-partes.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="http://iferminmontilla.com/cosas-que-amo-de-python-v-introspeccion-de-objetos.html" rel="bookmark"
                           title="Permalink to Cosas que AMO de Python V: Introspección de objetos">Cosas que AMO de Python V: Introspección de objetos</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2011-11-29T08:31:00">
                mar 29 noviembre 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://iferminmontilla.com/author/israel-fermin-montilla.html">Israel Fermín Montilla</a>
        </address>
        <p>In <a href="http://iferminmontilla.com/category/blog.html">Blog</a>. </p>
<p>tags: <a href="http://iferminmontilla.com/tag/lenguajes.html">Lenguajes</a><a href="http://iferminmontilla.com/tag/programacion.html">Programación</a><a href="http://iferminmontilla.com/tag/python.html">python</a></p>
</footer><!-- /.post-info -->                <p>Python, hace trivial lo que en otros lenguajes resulta complejo: la
introspección o reflexión de objetos. La reflexión o introspección de
objetos, es una técnica que permite a un programa cargar objetos que no
conoce, examinarlos y determinar sus variables de instancia y métodos
para trabajar con ellos.</p>
<p>Python nos ...</p>
                <a class="readmore" href="http://iferminmontilla.com/cosas-que-amo-de-python-v-introspeccion-de-objetos.html">read more</a>
                <p>There are <a href="http://iferminmontilla.com/cosas-que-amo-de-python-v-introspeccion-de-objetos.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="http://iferminmontilla.com/cosas-que-amo-de-python-iv-es-autodocumentado.html" rel="bookmark"
                           title="Permalink to Cosas que AMO de Python IV: es autodocumentado">Cosas que AMO de Python IV: es autodocumentado</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2011-09-15T07:54:00">
                jue 15 septiembre 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://iferminmontilla.com/author/israel-fermin-montilla.html">Israel Fermín Montilla</a>
        </address>
        <p>In <a href="http://iferminmontilla.com/category/blog.html">Blog</a>. </p>
<p>tags: <a href="http://iferminmontilla.com/tag/lenguajes.html">Lenguajes</a><a href="http://iferminmontilla.com/tag/programacion.html">Programación</a><a href="http://iferminmontilla.com/tag/python.html">python</a></p>
</footer><!-- /.post-info -->                <p>Confieso, confiésense, confesemos todos, todos somos adictos a Internet,
hasta un punto casi enfermizo. No se ustedes, pero si estoy en un lugar
sin Internet, o conexión de datos vía 3G, es como si me faltara el aire,
incluso, cuando se cae el servicio en mi casa o en la ...</p>
                <a class="readmore" href="http://iferminmontilla.com/cosas-que-amo-de-python-iv-es-autodocumentado.html">read more</a>
                <p>There are <a href="http://iferminmontilla.com/cosas-que-amo-de-python-iv-es-autodocumentado.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="http://iferminmontilla.com/cosas-que-amo-de-python-iii-todo-es-un-objeto.html" rel="bookmark"
                           title="Permalink to Cosas que AMO de Python III: todo es un objeto">Cosas que AMO de Python III: todo es un objeto</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2011-09-14T15:50:00">
                mié 14 septiembre 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://iferminmontilla.com/author/israel-fermin-montilla.html">Israel Fermín Montilla</a>
        </address>
        <p>In <a href="http://iferminmontilla.com/category/blog.html">Blog</a>. </p>
<p>tags: <a href="http://iferminmontilla.com/tag/lenguajes.html">Lenguajes</a><a href="http://iferminmontilla.com/tag/python.html">python</a></p>
</footer><!-- /.post-info -->                <p>Python, al igual que Java, es un lenguaje que soporta Orientación a
Objetos. Con la diferencia de que en Java, aún tenemos tipos primitivos
(bool, int, float, double) y sus respectivas clases envoltorio (Integer,
Float...). En Python, no existe tal cosa como &quot;clases envoltorio&quot;,
Python <strong>todo</strong> lo ve como un ...</p>
                <a class="readmore" href="http://iferminmontilla.com/cosas-que-amo-de-python-iii-todo-es-un-objeto.html">read more</a>
                <p>There are <a href="http://iferminmontilla.com/cosas-que-amo-de-python-iii-todo-es-un-objeto.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="http://iferminmontilla.com/cosas-que-amo-de-python-i-lists-comprehensions.html" rel="bookmark"
                           title="Permalink to Cosas que amo de Python I: Lists Comprehensions">Cosas que amo de Python I: Lists Comprehensions</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2011-09-11T21:28:00">
                dom 11 septiembre 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://iferminmontilla.com/author/israel-fermin-montilla.html">Israel Fermín Montilla</a>
        </address>
        <p>In <a href="http://iferminmontilla.com/category/blog.html">Blog</a>. </p>
<p>tags: <a href="http://iferminmontilla.com/tag/lenguajes.html">Lenguajes</a><a href="http://iferminmontilla.com/tag/programacion.html">Programación</a><a href="http://iferminmontilla.com/tag/python.html">python</a></p>
</footer><!-- /.post-info -->                <p>Bueno, ya que estoy trabajando con Python, he podido ir, poco a poco,
explorando las capacidades de ese lenguaje, es realmente poderoso y, tal
como una droga, su uso excesivo produce adicción. No pretendo
convertirlo en <em>el único lenguaje que usaré</em>pero si me enfocaré en
explorarlo y explotarlo por ...</p>
                <a class="readmore" href="http://iferminmontilla.com/cosas-que-amo-de-python-i-lists-comprehensions.html">read more</a>
                <p>There are <a href="http://iferminmontilla.com/cosas-que-amo-de-python-i-lists-comprehensions.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            </ol><!-- /#posts-list -->
                            <p class="paginator">
        Page 1 / 1
    </p>
                        </section><!-- /#content -->
                    <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://docs.notmyidea.org/alexis/pelican/">Pelican</a></li>
                                                    <li><a href="http://python.org">Python.org</a></li>
                                                    <li><a href="http://jinja.pocoo.org">Jinja2</a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://iferminmontilla.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="http://twitter.com/iferminm">Twitter</a></li>
                                                    <li><a href="http://www.linkedin.com/profile/view?id=66587805&trk=tab_pro">LinkedIn</a></li>
                                                    <li><a href="http://stackoverflow.com/users/1157389/israelord">StackOverflow</a></li>
                                                    <li><a href="https://github.com/iferminm">GitHub</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'iferminmblog';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>